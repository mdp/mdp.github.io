<!doctype html><html> <head>
<meta charset=utf-8>
<title>Mark Percival</title>
<meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1">
<script>var host="mdp.github.io";host==window.location.host&&window.location.protocol!="https:"&&(window.location=window.location.toString().replace(/^http:/,"https:"))</script>
<link rel="shortcut icon" href=/img/icon.png>
<link rel=apple-touch-icon href=/img/icon_128.png>
<link href="https://fonts.googleapis.com/css?family=Oswald:400,700" rel=stylesheet type=text/css>
<link href="https://fonts.googleapis.com/css?family=PT+Sans:400,700,400italic" rel=stylesheet type=text/css>
<meta name=author content="Mark Percival">
<meta name=description content="Mark Percival - Professional typist, man about town, person of interest">
<link rel=stylesheet href=/css/h5bp.css>
<link rel=stylesheet type=text/css media=all href=/css/skeleton.css>
<link rel=stylesheet type=text/css media=all href=/css/layout.css>
<link rel=stylesheet type=text/css media=all href=/css/master.css>
<link rel=stylesheet type=text/css media=all href=/css/pygments.css>
<link rel=stylesheet type=text/css media=all href=/css/main.css>
</head><body><div class=container>
<main>
<div id=header class="four alpha">
<h1><a href=/>MARK PERCIVAL</a></h1>
</div>
<article>
<div class=title>
<h2 class=title>Tumblr's shoehorned JS watches for dirty tricks</h1>
<div class="meta data">Jun 9, 2013</div>
</div>
<div id=post class="twelve columns alpha">
<p>I stumbled across this the other day on Tumblr.
One of the issues with letting people render
any HTML they want on your domain is that nefarious users can render a password
field on an official looking page and capture the input from the victim.</p>
<p>Tumblr seems to have come up strategy to try and prevent tricked users from
entering their passwords.</p>
<p>View the source and you&rsquo;ll see that they inject the following JS on the top of every page load before
the <code>&lt;html></code> tag. I&rsquo;ve beautified it and pasted it here:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js>(<span style=color:#66d9ef>function</span> () {
    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>a</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>translated_warning_string</span>;
    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>b</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>d</span>) {
        <span style=color:#a6e22e>d</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>d</span> <span style=color:#f92672>||</span> window.<span style=color:#a6e22e>event</span>;
        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>c</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>d</span>.<span style=color:#a6e22e>target</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>d</span>.<span style=color:#a6e22e>srcElement</span>;
        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>type</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;password&#34;</span>) {
            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>confirm</span>(<span style=color:#a6e22e>a</span>)) {
                <span style=color:#a6e22e>b</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>function</span> () {}
            } <span style=color:#66d9ef>else</span> {
                <span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>;
                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>
            }
        }
    };
    <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>typeof</span> document.<span style=color:#a6e22e>addEventListener</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;undefined&#34;</span>) {
        document.<span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#34;keypress&#34;</span>, <span style=color:#a6e22e>b</span>, <span style=color:#66d9ef>true</span>)
    }
})();
</code></pre></div><p>So essentially every keypress is checked to see if it&rsquo;s being entered into a
password field. If it is, then the user is warned with a localized string that
this is not a Tumblr password field:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>script</span><span style=color:#f92672>&gt;</span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>translated_warning_string</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Warning: Never enter your Tumblr password unless \u201chttps://www.tumblr.com/login\u201d\x0ais the address in your web browser.\x0a\x0aYou should also see a green \u201cTumblr, Inc.\u201d identification in the address bar.\x0a\x0aSpammers and other bad guys use fake forms to steal passwords.\x0a\x0aTumblr will never ask you to log in from a user\u2019s blog.\x0a\x0aAre you absolutely sure you want to continue?&#39;</span>;<span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/script&gt;</span>
</code></pre></div><p>Kind of a neat hack.</p>
</div>
<div class=post-tags>
<nav class="nav tags">
<ul class=tags>
<li><a href=/tags/github>github</a></li>
<li><a href=/tags/evernote>evernote</a></li>
</ul>
</nav>
</div>
</article><div id=footer class="sixteen columns alpha light">
Â© Mark Percival 2025
</div></main>
</div>
</body>
</html>